import * as React from "react";
import {
  Frame,
  FramerEvent,
  Animatable,
  PropertyControls,
  ControlType,
  RenderTarget
} from "framer";

interface Props {
  shortcode: string;
  width: number;
  height: number;
  type: string;
}

export class Instagram extends React.Component<Props> {

  private static direct = "Direct"
  private static embed = "Embed"
  private static embedWithCaption = "Embed with Caption"

  static defaultProps = {
    shortcode: "rSh8ykH_FT",
    type: Instagram.direct
  };

  static propertyControls: PropertyControls<Props> = {
    shortcode: { type: ControlType.String, title: "Shortcode" },
    type: { type: ControlType.Enum, title: "Type", options: [Instagram.direct, Instagram.embed, Instagram.embedWithCaption] },
  };

  placeholder(){

    const width = Animatable.getNumber(this.props.width);
    const height = Animatable.getNumber(this.props.height);

    const style: React.CSSProperties = {
      background: "#F8F8F8",
      lineHeight: 0,
      textAlign: "center",
      width: width,
      height: height,
      position: "absolute",
    };

    const styleIn: React.CSSProperties = {
      background: "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC)", 
      display: "block", 
      height: "44px", 
      position: "relative", 
      width: "44px",
      top: "50%",
      marginTop: "-22px",
      marginLeft: "auto",
      marginRight: "auto",
    };

    return (
      <div style={style}>
          <div style={styleIn}>
          </div>
      </div>
    )
  }

  renderEmbed(caption) {
    const width = Animatable.getNumber(this.props.width);
    const height = Animatable.getNumber(this.props.height);

    const embedStyle: React.CSSProperties = {
      maxWidth: '658px', 
      width: 'calc(100% - 2px)', 
      backgroundColor: 'white',  
      borderTopLeftRadius: '3px',  
      borderTopRightRadius: '3px',  
      borderBottomRightRadius: '3px',  
      borderBottomLeftRadius: '3px',  
      border: '1px solid rgb(219, 219, 219)',  
      boxShadow: 'none',
      display: 'block',  
      margin: '0px 0px 12px', 
      minWidth: '326px', 
      padding: '0px', 
    };

    var src = `https://www.instagram.com/p/${this.props.shortcode}/embed/`

    if (caption === true){
      src = `${src}captioned/`
    }
    
    return (
      <iframe style={embedStyle} src={src} allowTransparency={true} frameBorder={0} height={height}></iframe>
    );
  }

  renderImage() {
    const width = Animatable.getNumber(this.props.width);
    const height = Animatable.getNumber(this.props.height);

    return (
      <div
        style={{
          width: this.props.width,
          height: this.props.height,
          backgroundImage: this.props.shortcode
            ? `url(https://instagram.com/p/${this.props.shortcode}/media/?size=l)`
            : `none`,
          backgroundSize: "cover",
          backgroundPosition: "center top",
          backgroundRepeat: "no-repeat",
          display: "flex",
          justifyContent: "center",
          alignItems: "center",
          overflow: "hidden",
          position: "relative"
        }}
      >
      </div>
    );
  }

  render() {
    const { type, shortcode } = this.props;

    if (shortcode === ""){
      return this.placeholder()
    }
    
    switch (type) {
      case Instagram.direct:
        return this.renderImage()
      case Instagram.embed:
        return this.renderEmbed(false)
      case Instagram.embedWithCaption:
        return this.renderEmbed(true)
    }
  }
}
